<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>TensorFlow — The Scope of Software Engineering</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
<link href="https://anotherdatum.com/tensorflow-scoping.html" rel="canonical" />
  <!-- Feed -->
        <link href="https://anotherdatum.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Another Datum Full Atom Feed" />

  <link href="https://anotherdatum.com/theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="https://anotherdatum.com/theme/css/code_blocks/tomorrow.css" rel="stylesheet">

    <!-- CSS specified by the user -->


    <link href="https://anotherdatum.com/css/overrides.css" type="text/css" rel="stylesheet" />

  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->



    <meta name="description" content="How to structure your TensorFlow graph like a software engineer.">

    <meta name="author" content="Yoel Zeldes">

    <meta name="tags" content="tensorflow">
    <meta name="tags" content="software engineering">




<!-- Open Graph -->
<meta property="og:site_name" content="Another Datum"/>
<meta property="og:title" content="TensorFlow — The Scope of Software Engineering"/>
<meta property="og:description" content="How to structure your TensorFlow graph like a software engineer."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://anotherdatum.com/tensorflow-scoping.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-02-05 23:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://anotherdatum.com/author/yoel-zeldes.html">
  <meta property="article:publisher" content="https://www.facebook.com/yoel.zeldes" />
<meta property="article:section" content="tf-scope"/>
<meta property="article:tag" content="tensorflow"/>
<meta property="article:tag" content="software engineering"/>
<meta property="og:image" content="https://anotherdatum.com/images/tf-scope/cover.png">

<!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@YZeldes">
    <meta name="twitter:title" content="TensorFlow — The Scope of Software Engineering">
    <meta name="twitter:url" content="https://anotherdatum.com/tensorflow-scoping.html">

        <meta name="twitter:image:src" content="https://anotherdatum.com/images/tf-scope/cover.png">

      <meta name="twitter:description" content="How to structure your TensorFlow graph like a software engineer.">

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "TensorFlow — The Scope of Software Engineering",
  "headline": "TensorFlow — The Scope of Software Engineering",
  "datePublished": "2019-02-05 23:00:00+02:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Yoel Zeldes",
    "url": "https://anotherdatum.com/author/yoel-zeldes.html"
  },
  "image": "https://anotherdatum.com/images/tf-scope/cover.png",
  "url": "https://anotherdatum.com/tensorflow-scoping.html",
  "description": "How to structure your TensorFlow graph like a software engineer."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>
          <li><a href="https://anotherdatum.com" role="presentation">Posts</a></li>

              <li role="presentation"><a href="https://anotherdatum.com/pages/about.html">about me</a></li>
              <li role="presentation"><a href="https://anotherdatum.com/pages/resources.html">Resources</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="https://anotherdatum.com/" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">TensorFlow — The Scope of Software Engineering</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
            <time datetime="05 February 2019">05 February 2019</time>
        </span>
        <!-- TODO : Modified check -->
            <div class="post-cover cover" style="background-image: url('https://anotherdatum.com/images/tf-scope/cover.png')">
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>So you’ve finished training your model, and it’s time to get some insights as to
what it has learned. You decide which tensor should be interesting, and go look
for it in your code — to find out what its name is. Then it hits you — you
forgot to give it a name. You also forgot to wrap the logical code block with a
named scope. It means you’ll have a hard time getting a reference to the tensor.
It holds for python scripts as well as TensorBoard:</p>
<p><img alt="" src="images/tf-scope/bad_structure.png"></p>
<p>Can you see that small red circle lost in the sea of tensors? Finding it is
hard...</p>
<p>That’s a bummer! It would have been much better if it looked more like this:</p>
<p><img alt="" src="images/tf-scope/good_structure.png"></p>
<p>That’s more like it! Each set of tensors which form a logical unit is wrapped
inside a named scope.</p>
<p>Why can’t the graph be automatically constructed in a way that resembles your
code? I mean, most chances are you didn’t construct the model using a single
function, did you? Your code base contains multiple functions — each forms a
logical unit which deserves its own named scope!</p>
<p>Let’s say you have a tensor <code>x</code> which was defined by the function <code>f</code>, which in
turn was called by <code>g</code>. It means that while you were writing the code, you had
this logical structure in mind: <code>g</code> -&gt; <code>f</code> -&gt; <code>x</code>. Wouldn’t it be great if the
model would automatically be constructed in a way that the name of the tensor
would be <code>g/f/x</code>?</p>
<p>Come to think of it, it’s pretty simple to do. All you have to do is go over all
your functions and add a single line of code:</p>
<div class="highlight"><pre><span></span><code><span class="err">def f():</span>
<span class="err">    with tensorflow.name_scope(‘f’):</span>
<span class="err">        # define tensors</span>
</code></pre></div>

<p>So what’s wrong with that approach?</p>
<ol>
<li>The name of the function <code>f</code> appears twice — both in the function declaration
and as an argument to <code>tensorflow.name_scope</code>. Maybe next week you’ll change the
name of the function to something more meaningful, let’s say <code>foo</code>.
Unfortunately, you might forget to update the name of the scope!</li>
<li>You have to apply indentation to the entire body of <code>f</code>. While it’s not that
bad, personally I don’t like having high indentation levels. Let’s say <code>f</code>
contains a for loop which contains an if statement, which contains another for
loop. Thanks to calling to <code>tensorflow.name_scope</code>, we’re already at an
indentation level of 4!</li>
</ol>
<p>We can bypass these disadvantages using simple metaprogramming — Python’s
decorators to the rescue!</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">name_scope</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">r</span><span class="err">’</span><span class="p">[</span><span class="o">^</span><span class="n">_</span><span class="p">]</span><span class="err">’</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">():]</span>
        <span class="k">with</span> <span class="n">tensorflow</span><span class="o">.</span><span class="n">name_scope</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">func</span>

<span class="nd">@name_scope</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="c1"># define tensors</span>
</code></pre></div>

<p>How does it work? The <code>@</code> is a syntactic sugar. It’s equivalent to the
following:</p>
<div class="highlight"><pre><span></span><code><span class="n">def</span> <span class="n">foo</span><span class="p">():</span>
    <span class="o">#</span> <span class="n">define</span> <span class="n">tensors</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">name_scope</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
</code></pre></div>

<p><code>name_scope</code> gets a function as an argument (<code>f</code>) and returns a new function
(<code>func</code>). <code>func</code> creates a named scope, and then calls <code>f</code>.</p>
<p>The result? All the tensors that are defined by <code>f</code> will be created inside a
named scope. The name of the scope will be the name of the original function
(“foo”) — thanks to <code>f.__name__</code>.</p>
<p>One small problem is that while function names might start with “_”, tensorflow
scope names can’t. This is why we have to use <code>re</code>.</p>
<hr>
<h1>Why is it that important?</h1>
<p><img alt="" src="images/tf-scope/maintenance.jpg"></p>
<p>The challenge of writing clean tensorflow code is negligible compared to the
research challenge of actually making the model any good.</p>
<p>Thus, it’s easy to be tempted to just focus on the research aspects of your job.
However, in the long run, it’s important not to neglect the maintainability and
readability of your code, including those of your graph.</p>
<p>The decorator approach make my job a little easier, and I hope you’ll benefit
from it too. Do you have other tips you’d like to share? Drop a line in the
comments!</p>
<hr>
<p><em>Originally published by me at
<a href="https://engineering.taboola.com/tensorflow-scope-software-engineering">engineering.taboola.com</a>.</em></p>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=TensorFlow — The Scope of Software Engineering&amp;url=https://anotherdatum.com/tensorflow-scoping.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://anotherdatum.com/tensorflow-scoping.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="https://anotherdatum.com/tag/tensorflow.html">tensorflow</a><a href="https://anotherdatum.com/tag/software-engineering.html">software engineering</a>                </aside>

                <div class="clear"></div>


                </section>

<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:300px;}
	#mc_embed_signup form{padding: 0;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://anotherdatum.us14.list-manage.com/subscribe/post?u=6894d7badcfb253606fa3fb54&amp;id=c6f34ad6b7" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<h2>Get updated of new posts</h2>
<div class="mc-field-group">
	<label for="mce-EMAIL">Email Address </label>
	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
	<div id="mce-responses" class="clear">
		<div class="response" id="mce-error-response" style="display:none"></div>
		<div class="response" id="mce-success-response" style="display:none"></div>
	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_6894d7badcfb253606fa3fb54_c6f34ad6b7" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->
<hr />
                <aside class="post-nav">
                    <a class="post-nav-next" href="https://anotherdatum.com/vae-moe.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-left"></i>
                                <h2 class="post-nav-title">Mixture of Variational Autoencoders - a Fusion Between MoE and VAE</h2>
                            <p class="post-nav-excerpt">An unsupervised approach to digit classification and generation.</p>
                        </section>
                    </a>
                    <a class="post-nav-prev" href="https://anotherdatum.com/preparing-for-the-unexpected.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">Preparing for the Unexpected</h2>
                            <p class="post-nav-excerpt">How to apply your model to input it has never seen before.</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

                <div class="comments">
                    <h2>Comments !</h2>
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        var disqus_shortname = 'anotherdatum';
                        var disqus_identifier = 'tensorflow-scoping.html';
                        var disqus_url = 'https://anotherdatum.com/tensorflow-scoping.html';
                        (function() {
                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                            dsq.src = '//anotherdatum.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the comments.</noscript>
                </div>
            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
            <div class="social">
                <a href="https://il.linkedin.com/in/yoelzeldes">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                    </span>
                </a>
                <a href="https://github.com/yoel-zeldes">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                    </span>
                </a>
                <a href="https://www.facebook.com/yoel.zeldes">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                    </span>
                </a>
                <a href="https://twitter.com/YZeldes">
                    <span class="fa-stack fa-lg">
                        <i class="fa fa-circle fa-stack-2x"></i>
                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                    </span>
                </a>
            </div>

      <div class="inner">
        <section class="credits">
          <span class="credits-theme">Have a look at <a href="https://github.com/yoel-zeldes/yoel-zeldes.github.io/tree/source">the source code</a> of this blog.</span>
        </section>
      </div>
    </footer>
  </section>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script type="text/javascript" src="https://anotherdatum.com/theme/js/script.js"></script>

    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-83684090-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-83684090-1', { 'anonymize_ip': true });
    </script>
<script type="text/javascript">
    var disqus_shortname = 'anotherdatum';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>